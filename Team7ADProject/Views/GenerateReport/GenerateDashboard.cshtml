@{
    ViewBag.Title = "GenerateDashboard";
}

<head>

    <link href="~/Content/themes/base/jquery-ui.min.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-3.3.1.min.js"></script>
    <script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
    <script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>

    <script>
        $(function () {
            $("#fromDateTP").datepicker({
                altField: "#altfromDTP",
                altFormat: "d MM yy",
                yearRange: "2017:+0",
                maxDate: '0',
                changeMonth: true,
                changeYear: true,
                showOn: "both",
                defaultDate: "1/1/2017",
                onSelect: function (dateText, inst) {
                    $("#toDateTP").datepicker("option", "minDate", $("#fromDateTP").datepicker("getDate"));
                }
            });

            $("#toDateTP").datepicker({
                altField: "#alttoDTP",
                altFormat: "d MM yy",
                minDate: '-2y',
                maxDate: '0',
                changeMonth: true,
                changeYear: true,
                showOn: "both",
            });

            $('#filterBtn').click(function () {
                $.ajax({
                    url: '@Url.Action("GenerateDashboard", "GenerateReport")',
                    type: 'POST',
                    cache: false,
                    data: {
                        fromDateTP: $('#fromDateTP').datepicker("getDate"),
                        toDateTP: $('#toDateTP').datepicker("getDate") }
                }).done(function (result) {
                    $('#charts').html(result);
                });
            });
        });
    </script>

</head>

<h2>Store Dashboard</h2>
<p>
    Dates selected: <input type="text" id="altfromDTP" disabled> to
    <input type="text" id="alttoDTP" disabled>
</p>
<div style="width:80%;">
        <div id="ReportFilters" style="width:20%; height:100%; border:groove; float:right;">
            <p>Select period:</p>
            <p><input type="text" name="fromDateTP" id="fromDateTP"></p>
            <p><input type="text" name="toDateTP" id="toDateTP"></p>
            <input type="button" id="filterBtn" value="Filter" />
        </div>
    
    @if (IsPost)
    {
        <div id="charts">@Html.Action("_Charts",
                        new ViewDataDictionary { {"deptDataPoints",ViewBag.deptDataPoints },
                            { "statDataPoints",ViewBag.statDataPoints },
                            { "timedataPoints", ViewBag.timedataPoints } })</div>
    }
    else
    {
        <div id="charts">@Html.Partial("_Charts")</div>
    }
</div>